# CodePoetryEditor — A Throw of the Code

> *« Un coup de dés jamais n’abolira le hasard. »*  
> — Stéphane Mallarmé

코드는 보통 “동작해야 하는 것”으로 취급되지만,  
이 프로젝트에서는 코드를 **읽히는 시, 해체되는 페이지**로 다룹니다.  
`CodePoetryEditor`는 C/Java 소스 코드를 불러와 **의미는 보존한 채, 여백과 우연만을 과하게 조작하는 코드 포에트리 에디터**입니다.

---

## 1. 프로젝트 개요

- **언어**: HTML5 / CSS3 / Vanilla JavaScript (클라이언트 사이드만 사용)
- **컨셉**:  
  - 코드는 기능이 아니라 **감상**이다.  
  - 직접 텍스트를 입력하거나 잘라 붙일 수 없고,  
    오직 공백(스페이스, 줄바꿈)과 시각적 레이어만으로 코드를 변형한다.
- **기본 예제**:  
  - 초기 코드로 `Hello, Mallarmé!`를 출력하는 C 코드가 로드된다.
- **실행 방식**:  
  - 별도의 서버 없이 **브라우저에서 HTML 파일 하나만 열면 동작**하는 단일 페이지 도구.

---

## 2. 주요 기능

### 2-1. 코드 에디터 & 라인 넘버

- 좌측에 **라인 넘버**, 우측에 **코드 입력 영역**이 있는 구조 (VS Code 스타일 레이아웃).
- C/Java 문법을 단순 토큰화하여:
  - 키워드, 문자열, 주석, 전처리기 등을 서로 다른 색으로 하이라이트.
- 에디터와 라인 넘버, 백드롭 레이어가 스크롤에 맞춰 동기화된다.

### 2-2. 입력 제약 — “내용은 봉인하고, 여백만 허용”

에디터의 핵심 철학은:

> “코드는 의미론적 구조를 보존한 채, **여백만 해체**한다.”

그래서 다음과 같은 제약이 걸려 있다.

- **직접 타이핑으로 새 글자를 넣을 수 없음**
  - `beforeinput` 단계에서 공백이 아닌 문자의 삽입을 차단.
- **한글 입력 차단**
  - 한글이 포함되면 마지막 안전 상태로 되돌리고 경고 메시지 출력.
- **붙여넣기 / 자르기 금지**
  - `Ctrl+V`, `Ctrl+X`, 마우스 붙여넣기/잘라내기 모두 막음.
- **삭제도 제한적**
  - 공백, 주석 내부, 줄바꿈 연결 문자(`\` + 개행) 정도만 지울 수 있음.
  - 토큰(키워드, 식별자 등)의 문자 하나만 지워서 의미를 망가뜨리는 행위는 차단.

→ 결과적으로, 사용자는 **원본 코드의 “텍스트 내용”을 바꾸지 못하고**,  
   오로지 공백·줄바꿈·레이어만으로 코드를 재구성하게 된다.

### 2-3. [가능성의 공간 탐색] 모드 (Guide Mode)

> 상태바 단축키: `Ctrl + Shift + L`

- 토글 시 에디터에 `.guide-mode` 클래스를 적용.
- 토큰화 과정에서 **공백(스페이스, 탭, 줄바꿈)을 `token-space`로 표시**하고,
  이 영역을 하이라이트해 **“보이지 않던 간격의 패턴”**을 시각화.
- ON/OFF 상태는 상태바에 `[가능성의 공간 탐색] ON/OFF`로 표시된다.

이 모드는 말라르메가 말한 **여백과 조판의 시학**을 코드에 그대로 옮기는 역할을 한다.

### 2-4. [우연의 개입] 모드 (Dadaism)

> 상태바 단축키: `Ctrl + Shift + D`  
> 헤더 버튼: 우측 상태바에서도 클릭 가능

- 모달 창을 띄워 두 가지 슬라이더를 조절한다.
  1. **수직적 해체 (Vertical Deconstruction)**  
     - 줄 사이에 임의의 줄바꿈을 삽입해 코드를 위아래로 늘어뜨린다.
  2. **수평적 파편 (Horizontal Fragments)**  
     - 토큰 사이의 공백을 늘리거나 잘라 **수평 방향의 파편화**를 만든다.
- 알고리즘은 정규식 기반 토큰화로:
  - 키워드·문자열·주석·전처리기 등의 **의미 단위는 손대지 않고**,  
    그 사이의 공백만 조작한다.
- 실행 시:
  - 화면에 짧은 플래시 효과가 발생하고,
  - `🎲 [우연의 개입] (V:x, H:y)` 기록이 HISTORY에 남는다.
  - 엔트로피 패널과 라인 수가 갱신된다.

### 2-5. [덧칠하기] (Overpainting)

> 단축키: `Ctrl + M` (선택 영역 또는 커서가 올라간 단어 기준)

- 현재 선택된 범위가 없으면, 커서 위치의 “단어”를 자동으로 감지해 선택.
- 커서 근처에 작은 입력 팝업이 떠서 **간단한 미니 CSS 문법**으로 스타일을 지정할 수 있다.

예시 입력:

- `color:#ffcc00`
- `size:20px`
- `bg:#222222`
- `blur:2px`
- `bold:true`
- 또는 일반 CSS 속성: `letter-spacing:4px`

지원 키워드:

- `size` → `font-size`
- `color` → 텍스트 색
- `bg` → 배경색
- `blur` → `filter: blur(...)`
- `bold` → `font-weight: bold`

이 입력을 파싱한 후, 내부의 `styleOverlays` 배열에  
`{ start, end, style }` 형태로 저장하고, 렌더링 단계에서  
해당 토막만 감싸는 `<span>`을 쪼개서 오버레이 스타일을 입힌다.

→ 결과적으로, **코드 위에 또 하나의 “회화적 레이어”를 얹는 덧칠 효과**를 제공한다.

### 2-6. [말 더듬기] (Smart String Break)

> 단축키: `Ctrl + Shift + Enter`  
> (문자열 리터럴 내부에서만 작동)

- 커서가 현재 문자열 토큰(큰따옴표 `"…"`, 작은따옴표 `'…'`) 내부에 있는지  
  토큰 단위로 탐색한 뒤, 내부가 아니면 경고 메시지를 띄우고 종료한다.
- 문자열 안에서 실행될 경우:
  - **C 계열 코드**에서는  
    ` \` + 개행 + 들여쓰기` 형태의 줄바꿈 연결 문자를 삽입하여  
    문자열이 여러 줄로 **더듬거리듯 끊겨 나오도록** 만든다.
  - **Java 코드**에서는  
    `" + \n    "` 형태의 문자열 연결(`"..." + "..."`)을 사용해  
    같은 효과를 낸다.
- 실행 후에는 `"💥 [말 더듬기]"`라는 메시지가 히스토리에 기록된다.

### 2-7. 오른쪽 패널: Entropy & History

#### Entropy 패널

- **TOTAL LINES**: 현재 코드의 총 라인 수
- **Original**: 원본 코드의 라인 수
- **성장률 (Growth Rate)**:  
  \[
  \text{growth} = \frac{\text{현재 줄 수} - \text{원본 줄 수}}{\text{원본 줄 수}} \times 100\%
  \]
  를 정수로 반올림 후, `+30%` 같은 형식으로 표시.
- **Chaos Level**:  
  - `LV = floor(growth / 50) + 1`  
  - 여백이 늘어날수록 엔트로피 레벨이 올라간다.

#### History 패널

- 각 편집 액션마다 `saveHistory(action)`으로 스냅샷을 남긴다.
  - 예: `Initial Load`, `File Open: foo.c`,  
    `🎲 [우연의 개입] (V:3, H:5)`, `🖌️ [덧칠하기] 적용됨` 등.
- 최근 상태부터 역순으로 리스트가 생성되며,
  각 항목을 클릭하면 해당 시점으로 **즉시 롤백**된다.
- `Ctrl+Z` / `Ctrl+Y` 로도 Undo / Redo를 지원.
- 휴지통 아이콘(🗑️) 버튼으로 히스토리 전체를 정리할 수 있다.

### 2-8. 파일 불러오기 / 저장 / PNG 캡쳐

헤더 영역에서 제공하는 기능:

- **📂 불러오기**
  - `C, C++, Java, (h/hpp)` 파일만 허용 (`.c, .cpp, .h, .hpp, .java`)
  - 파일을 열면:
    - 에디터에 내용이 로드되고,
    - `Original` 라인 수가 새로 설정되며,
    - `File Open: <파일명>`이 HISTORY에 기록.

- **TXT 저장 버튼**
  - 현재 화면의 코드를 **순수 텍스트(.txt)** 파일로 다운로드.

- **C/Java 저장 버튼**
  - 현재 선택된 언어(`currentLanguage`)에 따라  
    `.c` 또는 `.java` 확장자로 다운로드.

- **📷 PNG (캡쳐)**
  - 내부적으로 `<canvas>`를 생성해:
    - 현재 코드 텍스트를 다시 토큰화하고,
    - 문법 색상 정보를 그대로 사용해
    - 어두운 배경 위에 코드를 한 줄씩 그려 넣은 뒤
  - 하나의 PNG 이미지로 다운로드한다.  
  - 즉, **“코드 한 장”을 시각 작품처럼 내보내는 기능**이다.

- **폰트 크기 조절 (Zoom)**
  - `＋`, `－` 버튼으로 기본 폰트 크기를 키우거나 줄일 수 있다.
  - 전체 UI는 CSS 변수(`--base-font-size`)를 통해 이에 맞춰 재계산된다.

### 2-9. 상태바 & 단축키 요약

하단 상태바에는 현재 파일명과 함께  
주요 시적(?) 기능들이 단축키와 함께 나열된다.

- `Ctrl + O` : 코드 불러오기
- `Ctrl + S` : 현재 코드를 `.c` 또는 `.java`로 저장
- `Ctrl + Shift + L` : [가능성의 공간 탐색] 토글
- `Ctrl + Shift + D` : [우연의 개입] 모달 열기
- `Ctrl + M` : [덧칠하기] 팝업 열기 (선택 영역 또는 현재 단어)
- `Ctrl + Shift + Enter` : [말 더듬기] 실행 (문자열 내부에서만)
- `Ctrl + Z` / `Ctrl + Y` : Undo / Redo

---

## 3. 실행 방법

1. 이 저장소를 클론하거나 ZIP으로 다운로드한다.
2. 로컬 폴더에서 `CodePoetryEditor.html`을 더블 클릭한다.
   - 또는 브라우저에서 `파일 → 열기`로 HTML 파일을 선택.
3. 최신 버전의 Chrome / Edge / Firefox를 권장한다.
4. 기본으로 로드되는 `Hello, Mallarmé!` 코드 위에서  
   각 모드와 단축키들을 자유롭게 실험한다.

---

## 4. 프로젝트 구조

현재 버전 기준:

- `CodePoetryEditor.html`  
  - 에디터 UI, 스타일, 스크립트가 모두 들어 있는 단일 HTML 파일
- `LICENSE`  
  - MIT License
- `README.md`  
  - 이 문서
- (선택) `CodePoetryFont.woff2`  
  - `@font-face` 설정을 통해 연결할 수 있는 커스텀 폰트 파일

---

## 5. 폰트 커스터마이징

`<head>` 영역의 `@font-face` 정의를 수정하면  
사용자가 변환한 WOFF2 폰트를 연결해 에디터의 “목소리”를 바꿀 수 있다.

```css
@font-face {
    font-family: 'CodePoetryFont';
    src: url('CodePoetryFont.woff2') format('woff2');
    font-weight: normal;
    font-style: normal;
}
